# 目录: infiniop-test/include 架构全景

## 1. 子系统职责
本目录是 `infiniop-test` 测试框架的核心头文件集合，为 InfiniOp 算子测试提供必要的类型定义、工具类和测试基础设施。该目录不包含子目录，是一个叶子节点，直接暴露所有必要的 C++ 接口供测试程序使用。

## 2. 模块导航 (Module Navigation)

本目录为叶子节点，包含以下 6 个核心头文件：

* **file_mapping.hpp**
    * 功能: 跨平台文件内存映射工具
    * 职责: 提供 Windows 和 Linux 平台下的文件内存映射功能，支持零拷贝文件访问

* **gguf.hpp**
    * 功能: GGUF 文件格式解析器
    * 职责: 定义 GGUF/GGML 数据类型系统，提供 GGUF 模型文件读取能力，支持元数据和张量信息的解析

* **tensor.hpp**
    * 功能: 张量抽象与内存管理
    * 职责: 封装 InfiniOp 张量描述符，提供设备内存管理、数据类型转换和跨设备数据传输

* **test.hpp**
    * 功能: 测试框架基础设施
    * 职责: 定义测试基类、结果枚举、测试注册宏和测试执行器，是整个测试框架的核心

* **ops.hpp**
    * 功能: 算子测试注册表
    * 职责: 声明所有支持的算子测试（gemm、rms_norm、rope 等），维护测试构建器映射表

* **utils.hpp**
    * 功能: 通用工具函数
    * 职责: 提供 GGML 类型数据读取、类型大小查询等辅助功能，依赖上层 utils.h

## 3. 架构逻辑图解

该目录作为测试框架的接口层，各头文件之间形成明确的依赖层次：

**依赖关系链**:
```
utils.hpp (工具函数)
    ↓
file_mapping.hpp (文件映射) → gguf.hpp (文件解析)
    ↓                              ↓
                            tensor.hpp (张量对象)
                                    ↓
                            test.hpp (测试框架)
                                    ↓
                            ops.hpp (算子注册)
```

**数据流动逻辑**:

1. **文件加载流程**: `file_mapping.hpp` 提供内存映射 → `gguf.hpp` 解析 GGUF 格式 → 提取模型元数据和张量信息

2. **张量构建流程**: `gguf.hpp` 读取张量信息 → `tensor.hpp` 创建 Tensor 对象（包装 InfiniOp 描述符） → 使用 `utils.hpp` 进行类型转换

3. **测试执行流程**: `ops.hpp` 注册测试构建器 → `test.hpp` 基类定义测试接口 → 各算子测试继承并实现 → 通过 `test.hpp` 的执行器运行

**设计特点**:

- **分层清晰**: 从底层文件操作到高层测试框架，职责明确分离
- **跨平台支持**: file_mapping.hpp 同时支持 Windows 和 Linux
- **类型安全**: 完整的 GGML 类型枚举和 InfiniOp 类型映射
- **可扩展架构**: 通过宏机制（DECLARE_INFINIOP_TEST）轻松添加新算子测试
- **零拷贝优化**: 使用内存映射避免不必要的文件数据复制

**与上层系统的集成**:

本目录的头文件被 `infiniop-test/src` 中的具体测试实现文件引用，形成完整的测试可执行程序。测试框架通过 GGUF 文件驱动，可以自动从模型文件中提取测试用例并验证 InfiniOp 算子的正确性。
